{"version":3,"file":"bundles/cb51be0e75c2e926185d/3636.js","mappings":"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","sources":["webpack://element-web/./src/effects/fireworks/index.ts"],"sourcesContent":["/*\r\nCopyright 2024 New Vector Ltd.\r\nCopyright 2023 The Matrix.org Foundation C.I.C.\r\nCopyright 2020 Nurjin Jafar\r\nCopyright 2020 Nordeck IT + Consulting GmbH.\r\n\r\nSPDX-License-Identifier: AGPL-3.0-only OR GPL-3.0-only OR LicenseRef-Element-Commercial\r\nPlease see LICENSE files in the repository root for full details.\r\n */\r\n\r\nimport type ICanvasEffect from \"../ICanvasEffect\";\r\n\r\nexport type FireworksOptions = {\r\n    /**\r\n     * max fireworks count\r\n     */\r\n    maxCount: number;\r\n    /**\r\n     * gravity value that firework adds to shift from it's start position\r\n     */\r\n    gravity: number;\r\n};\r\n\r\ntype FireworksParticle = {\r\n    /**\r\n     * color\r\n     */\r\n    color: string;\r\n    /**\r\n     * x,y are the point where the particle starts to position on canvas\r\n     */\r\n    x: number;\r\n    y: number;\r\n    /**\r\n     * vx,vy shift values from x and y\r\n     */\r\n    vx: number;\r\n    vy: number;\r\n    /**\r\n     * the alpha opacity of the firework particle (between 0 and 1, where 1 is opaque and 0 is invisible)\r\n     */\r\n    alpha: number;\r\n    /**\r\n     * w,h width and height\r\n     */\r\n    w: number;\r\n    h: number;\r\n};\r\n\r\nexport const DefaultOptions: FireworksOptions = {\r\n    maxCount: 500,\r\n    gravity: 0.05,\r\n};\r\n\r\nexport default class Fireworks implements ICanvasEffect {\r\n    private readonly options: FireworksOptions;\r\n\r\n    public constructor(options: { [key: string]: any }) {\r\n        this.options = { ...DefaultOptions, ...options };\r\n    }\r\n\r\n    private context: CanvasRenderingContext2D | null = null;\r\n    private supportsAnimationFrame = window.requestAnimationFrame;\r\n    private particles: Array<FireworksParticle> = [];\r\n    public isRunning = false;\r\n\r\n    public start = async (canvas: HTMLCanvasElement, timeout = 3000): Promise<void> => {\r\n        if (!canvas) {\r\n            return;\r\n        }\r\n        this.isRunning = true;\r\n        this.context = canvas.getContext(\"2d\");\r\n        this.supportsAnimationFrame.call(window, this.updateWorld);\r\n        if (timeout) {\r\n            window.setTimeout(this.stop, timeout);\r\n        }\r\n    };\r\n\r\n    private updateWorld = (): void => {\r\n        if (!this.isRunning && this.particles.length === 0) return;\r\n        this.update();\r\n        this.paint();\r\n        this.supportsAnimationFrame.call(window, this.updateWorld);\r\n    };\r\n\r\n    private update = (): void => {\r\n        if (this.particles.length < this.options.maxCount && this.isRunning) {\r\n            this.createFirework();\r\n        }\r\n        const alive: FireworksParticle[] = [];\r\n        for (let i = 0; i < this.particles.length; i++) {\r\n            if (this.move(this.particles[i])) {\r\n                alive.push(this.particles[i]);\r\n            }\r\n        }\r\n        this.particles = alive;\r\n    };\r\n\r\n    private paint = (): void => {\r\n        if (!this.context || !this.context.canvas) return;\r\n        this.context.globalCompositeOperation = \"destination-out\";\r\n        this.context.fillStyle = \"rgba(0,0,0,0.5)\";\r\n        this.context.fillRect(0, 0, this.context.canvas.width, this.context.canvas.height);\r\n        this.context.globalCompositeOperation = \"lighter\";\r\n        for (let i = 0; i < this.particles.length; i++) {\r\n            this.drawParticle(this.particles[i]);\r\n        }\r\n    };\r\n\r\n    private createFirework = (): void => {\r\n        if (!this.context || !this.context.canvas) return;\r\n        const width = this.context.canvas.width;\r\n        const height = this.context.canvas.height;\r\n        const xPoint = Math.random() * (width - 200) + 100;\r\n        const yPoint = Math.random() * (height - 200) + 100;\r\n        const nFire = Math.random() * 50 + 100;\r\n        const color =\r\n            \"rgb(\" +\r\n            ~~(Math.random() * 200 + 55) +\r\n            \",\" +\r\n            ~~(Math.random() * 200 + 55) +\r\n            \",\" +\r\n            ~~(Math.random() * 200 + 55) +\r\n            \")\";\r\n        for (let i = 0; i < nFire; i++) {\r\n            const particle = <FireworksParticle>{};\r\n            particle.color = color;\r\n            particle.w = particle.h = Math.random() * 4 + 1;\r\n            particle.x = xPoint - particle.w / 2;\r\n            particle.y = yPoint - particle.h / 2;\r\n            particle.vx = (Math.random() - 0.5) * 10;\r\n            particle.vy = (Math.random() - 0.5) * 10;\r\n            particle.alpha = Math.random() * 0.5 + 0.5;\r\n            const vy = Math.sqrt(25 - particle.vx * particle.vx);\r\n            if (Math.abs(particle.vy) > vy) {\r\n                particle.vy = particle.vy > 0 ? vy : -vy;\r\n            }\r\n            this.particles.push(particle);\r\n        }\r\n    };\r\n\r\n    public stop = async (): Promise<void> => {\r\n        this.isRunning = false;\r\n    };\r\n\r\n    private drawParticle = (particle: FireworksParticle): void => {\r\n        if (!this.context || !this.context.canvas) {\r\n            return;\r\n        }\r\n        this.context.save();\r\n        this.context.beginPath();\r\n\r\n        this.context.translate(particle.x + particle.w / 2, particle.y + particle.h / 2);\r\n        this.context.arc(0, 0, particle.w, 0, Math.PI * 2);\r\n        this.context.fillStyle = particle.color;\r\n        this.context.globalAlpha = particle.alpha;\r\n\r\n        this.context.closePath();\r\n        this.context.fill();\r\n        this.context.restore();\r\n    };\r\n\r\n    private move = (particle: FireworksParticle): boolean => {\r\n        particle.x += particle.vx;\r\n        particle.vy += this.options.gravity;\r\n        particle.y += particle.vy;\r\n        particle.alpha -= 0.01;\r\n        return !(\r\n            particle.x <= -particle.w ||\r\n            particle.x >= screen.width ||\r\n            particle.y >= screen.height ||\r\n            particle.alpha <= 0\r\n        );\r\n    };\r\n}\r\n"],"names":["DefaultOptions","maxCount","gravity","Fireworks","constructor","options","_defineProperty","window","requestAnimationFrame","async","canvas","timeout","this","isRunning","context","getContext","supportsAnimationFrame","call","updateWorld","setTimeout","stop","particles","length","update","paint","createFirework","alive","i","move","push","globalCompositeOperation","fillStyle","fillRect","width","height","drawParticle","xPoint","Math","random","yPoint","nFire","color","particle","w","h","x","y","vx","vy","alpha","sqrt","abs","save","beginPath","translate","arc","PI","globalAlpha","closePath","fill","restore","screen","_objectSpread"],"sourceRoot":""}