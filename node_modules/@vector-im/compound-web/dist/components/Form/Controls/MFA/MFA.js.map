{"version":3,"file":"MFA.js","sources":["../../../../../src/components/Form/Controls/MFA/MFA.tsx"],"sourcesContent":["/*\nCopyright 2025 New Vector Ltd.\nCopyright 2023 The Matrix.org Foundation C.I.C.\nCopyright 2023 New Vector Ltd\n\nSPDX-License-Identifier: AGPL-3.0-only OR LicenseRef-Element-Commercial\nPlease see LICENSE files in the repository root for full details.\n*/\n\nimport React, {\n  type ComponentProps,\n  type ComponentRef,\n  forwardRef,\n  type PropsWithoutRef,\n} from \"react\";\n\nimport styles from \"./MFA.module.css\";\nimport classNames from \"classnames\";\nimport { Control } from \"@radix-ui/react-form\";\n\ntype DigitProps = {\n  filled: boolean;\n  selected: boolean;\n};\n\nconst Digit: React.FC<DigitProps> = ({ filled, selected }) => (\n  <div\n    className={styles.digit}\n    aria-hidden=\"true\"\n    data-filled={filled ? \"\" : undefined}\n    data-selected={selected ? \"\" : undefined}\n  />\n);\n\ntype MFAProps = {\n  className?: string;\n  length?: number;\n  disabled?: boolean;\n} & Omit<\n  React.ComponentProps<\"input\">,\n  \"type\" | \"inputMode\" | \"pattern\" | \"autoComplete\"\n>;\n\nexport const MFAInput = forwardRef(function MFAInput(\n  { className, length = 6, ...props }: PropsWithoutRef<MFAProps>,\n  ref: React.ForwardedRef<HTMLInputElement>,\n) {\n  const classes = classNames(styles.container, className);\n  const [currentLength, setCurrentLength] = React.useState(0);\n  const [selection, setSelection] = React.useState<null | [number, number]>(\n    null,\n  );\n\n  const update = (event: React.SyntheticEvent<HTMLInputElement>) => {\n    const input = event.currentTarget;\n    setCurrentLength(input.value?.length);\n\n    if (\n      document.activeElement !== input ||\n      input.selectionStart === null ||\n      input.selectionEnd === null\n    ) {\n      setSelection(null);\n    } else {\n      setSelection([input.selectionStart, input.selectionEnd]);\n    }\n  };\n\n  return (\n    <div className={classes}>\n      <input\n        {...props}\n        inputMode=\"numeric\"\n        // Showing digits on mobile browsers. Using numbers is not really suited\n        // as it often adds a way to increment or decrement the current value\n        // which is not interesting for this use case\n        type=\"text\"\n        minLength={0}\n        maxLength={length}\n        className={styles.control}\n        pattern={`\\\\d{${length}}`}\n        autoComplete=\"one-time-code\"\n        onSelect={update}\n        onFocus={update}\n        onBlur={update}\n        onMouseDown={update}\n        onMouseMove={update}\n        onMouseUp={update}\n        onChange={update}\n        ref={ref}\n      />\n      {Array.from(Array(length).keys()).map((index) => (\n        <Digit\n          key={index}\n          filled={index < currentLength}\n          selected={\n            !!selection && index >= selection[0] && index < selection[1]\n          }\n        />\n      ))}\n    </div>\n  );\n});\n\nexport const MFAControl = forwardRef<\n  ComponentRef<typeof MFAInput>,\n  ComponentProps<typeof MFAInput>\n>(function ActionControl(props, ref) {\n  return (\n    <Control asChild>\n      <MFAInput ref={ref} {...props} />\n    </Control>\n  );\n});\n"],"names":["MFAInput"],"mappings":";;;;;AAyBA,MAAM,QAA8B,CAAC,EAAE,QAAQ,eAC7C;AAAA,EAAC;AAAA,EAAA;AAAA,IACC,WAAW,OAAO;AAAA,IAClB,eAAY;AAAA,IACZ,eAAa,SAAS,KAAK;AAAA,IAC3B,iBAAe,WAAW,KAAK;AAAA,EAAA;AACjC;AAYK,MAAM,WAAW,WAAW,SAASA,UAC1C,EAAE,WAAW,SAAS,GAAG,GAAG,MAAA,GAC5B,KACA;AACA,QAAM,UAAU,WAAW,OAAO,WAAW,SAAS;AACtD,QAAM,CAAC,eAAe,gBAAgB,IAAI,MAAM,SAAS,CAAC;AAC1D,QAAM,CAAC,WAAW,YAAY,IAAI,MAAM;AAAA,IACtC;AAAA,EAAA;AAGF,QAAM,SAAS,CAAC,UAAkD;AAChE,UAAM,QAAQ,MAAM;AACpB,qBAAiB,MAAM,OAAO,MAAM;AAEpC,QACE,SAAS,kBAAkB,SAC3B,MAAM,mBAAmB,QACzB,MAAM,iBAAiB,MACvB;AACA,mBAAa,IAAI;AAAA,IACnB,OAAO;AACL,mBAAa,CAAC,MAAM,gBAAgB,MAAM,YAAY,CAAC;AAAA,IACzD;AAAA,EACF;AAEA,SACE,qBAAC,OAAA,EAAI,WAAW,SACd,UAAA;AAAA,IAAA;AAAA,MAAC;AAAA,MAAA;AAAA,QACE,GAAG;AAAA,QACJ,WAAU;AAAA,QAIV,MAAK;AAAA,QACL,WAAW;AAAA,QACX,WAAW;AAAA,QACX,WAAW,OAAO;AAAA,QAClB,SAAS,OAAO,MAAM;AAAA,QACtB,cAAa;AAAA,QACb,UAAU;AAAA,QACV,SAAS;AAAA,QACT,QAAQ;AAAA,QACR,aAAa;AAAA,QACb,aAAa;AAAA,QACb,WAAW;AAAA,QACX,UAAU;AAAA,QACV;AAAA,MAAA;AAAA,IAAA;AAAA,IAED,MAAM,KAAK,MAAM,MAAM,EAAE,MAAM,EAAE,IAAI,CAAC,UACrC;AAAA,MAAC;AAAA,MAAA;AAAA,QAEC,QAAQ,QAAQ;AAAA,QAChB,UACE,CAAC,CAAC,aAAa,SAAS,UAAU,CAAC,KAAK,QAAQ,UAAU,CAAC;AAAA,MAAA;AAAA,MAHxD;AAAA,IAAA,CAMR;AAAA,EAAA,GACH;AAEJ,CAAC;AAEM,MAAM,aAAa,WAGxB,SAAS,cAAc,OAAO,KAAK;AACnC,SACE,oBAAC,WAAQ,SAAO,MACd,8BAAC,UAAA,EAAS,KAAW,GAAG,MAAA,CAAO,EAAA,CACjC;AAEJ,CAAC;"}